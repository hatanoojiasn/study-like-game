# Quest 03: 超小型 VM スクリプティング

## 目的（Objective）
- 敵 AI / イベント制御のために、字句解析→構文解析→バイトコード→実行の最小 VM を内部実装として追加する。

## ルール（Rules）
- 公開 API 追加は禁止（内部モジュールで完結）。
- 実行時間予算を設け、1フレームで実行する命令数を制限する。
- エラーは行/列付きで報告する。

## 制約（Constraints）
- VM の状態はエンジン内部に保持する。
- ホスト I/O と VM 命令を直接結合しすぎない。

## 受け入れ条件（Definition of Done）
- 最小言語で条件分岐・簡単な状態遷移が実行できる。
- 命令数上限（例: 1フレーム 500 命令）を超えた場合の挙動が定義されている。
- スクリプトエラー時に `line:column` を表示し、クラッシュしない。
- 負荷時のフレーム落ち率を計測し、閾値内に収める。

## 実装ヒント
- まずは式を削った命令列中心 DSL で始める。
- 字句解析と構文解析を分離し、トークン位置情報を保持する。
- バイトコードは固定長命令を優先し、デコーダを単純化する。

## テスト計画（最低限）
1. 字句/構文の正常系・異常系テスト
2. バイトコード実行のステップ上限テスト
3. 実ゲームループでのフレーム時間監視
