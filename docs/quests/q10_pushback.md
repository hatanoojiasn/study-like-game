# Q10: めり込み修復を実施せよ

## 0. ミッション概要
学習ラボ世界ではシステム障害が連鎖し、観測と修復の速度が落ちています。
あなたは整備士として今回の破損点を特定し、次のTierへ進む通路を開きます。

## 1. 症状
- 観測現象: 衝突後に対象が重なったまま固定される。
- 再現手順:
  1. 既定ビルドを起動する。
  2. 60秒程度プレイし、HUD/ログを確認する。
  3. 異常発生時刻と入力状況を記録する。
- ログ例:
```text
[timing] avg=21.4ms min=1ms max=144ms frames=47
[warn] quest=Q10 anomaly_detected=true
```

## 2. なぜ重要か
この症状を放置すると、次Tierの修理で「不具合か仕様か」を判定できなくなります。結果として学習時間が調査迷子に吸われ、達成感が失われます。

## 3. 目標
- 今回の修理点を実装し、異常を再現可能な形で抑制する。
- 内部実装だけを更新し、公開APIは固定のまま維持する。

## 4. 達成報酬
- 解放能力（アンロック）: **空間整合性解放**
- 世界の変化: 修理後は挙動が滑らかになり、次ミッションの解析情報が可視化される。

## 5. 受け入れ条件（Definition of Done）
- 定量条件1: 対象メトリクスを30〜300秒観測し、改善前後の差分をログで提示できる。
- 定量条件2: 修理後に同一手順を3回実施し、成功率100%で再現/修復が確認できる。
- 定量条件3: 公開ヘッダ（platform/game/engine）の関数シグネチャ変更がない。

## 6. 失敗例（最低3つ）
1. 体感だけで「直った」と判断し、ログ計測が残っていない。
2. 一度だけ成功した結果を一般化し、再現試験を省略する。
3. 問題回避のために公開APIを追加し、将来Questの自由度を下げる。

## 7. 用語ミニ辞典
- **dt**: フレーム間の経過時間。更新の安定性を左右する基本値。
- **ジッタ**: 時間間隔の揺らぎ。大きいほどカクつきや遅延感が増える。
- **決定性**: 同じ入力なら同じ結果になる性質。デバッグ効率に直結する。
- **ヘッドレステスト**: ウィンドウ表示なしで実行するテスト。CI向き。
- **協調スケジューリング**: タスクが自発的に処理を譲る実行方式。
- **AABB**: 軸平行境界ボックス衝突判定。実装が軽く学習向き。
- **バイトコード**: VMが実行しやすい中間命令列。

## 8. 実装の方向性
- 方向A: 小さく導入し、ログ観測点を先に増やしてから挙動を変える（安全・遅い）。
- 方向B: 挙動を先に作って後で測定を足す（速い・原因追跡が難しい）。
- 推奨: 方向A。まず可観測性を確保すると失敗時の切り戻しが容易。
- 落とし穴: フレーム内で動的確保を混ぜると、今回の改善効果をノイズが打ち消す。

## 9. テスト計画
- 自動テスト: 既存の決定性テストを実行し、退行がないことを確認する。
- 手動テスト: 60秒操作 + 60秒放置を1セットとして3回実施。
- ログ確認: avg/min/max dt、ジッタ、対象Questメトリクスを比較表にまとめる。

## 10. 次のクエストにどう繋がるか
この修理で得た可観測性と安定性は、次のQuestで扱う複雑系（並行処理/物理/VM/移植）の土台になります。
押し戻し解決を追加して重なりを解消する。 ことで、次段の実装難易度を一段下げられます。
